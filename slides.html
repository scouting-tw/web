<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡å ±é…æ¨‚æ¨¡å¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 1. ç°¡å ±å®¹å™¨ï¼šå…¨è¢å¹•æ™‚æœƒä½”æ»¿ç•«é¢ 
           èƒŒæ™¯è¨­ç‚ºé»‘ï¼Œé¿å…è¼‰å…¥æ™‚é–ƒçˆ
        */
        #presentation-container {
            display: none; /* é è¨­éš±è— */
            width: 100%;
            height: 100%;
            background-color: black;
        }

        /* è®“ Google Slides iframe å¡«æ»¿å®¹å™¨ */
        #presentation-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* 2. éš±è—çš„ YouTube æ’­æ”¾å™¨ 
           æ³¨æ„ï¼šä¸èƒ½è¨­ç‚º display: noneï¼Œå¦å‰‡ç€è¦½å™¨å¯èƒ½æœƒé™åˆ¶æ’­æ”¾ã€‚
           æŠ€å·§æ˜¯è¨­ç‚ºæ¥µå°ä¸”é€æ˜ã€‚
        */
        #music-player-container {
            position: absolute;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen">

    <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-md">
        <h1 class="text-3xl font-bold mb-2 text-gray-800">æ²‰æµ¸å¼ç°¡å ±</h1>
        <p class="text-gray-500 mb-6">Google Slides + YouTube èƒŒæ™¯æ°›åœéŸ³æ¨‚</p>
        
        <button id="start-btn" onclick="startExperience()" 
                class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-8 rounded-full transition transform hover:scale-105 shadow-lg flex items-center justify-center gap-3 mx-auto">
            <span>ğŸš€</span> é–‹å§‹æ¼”ç¤º (å«é…æ¨‚)
        </button>
        <p id="loading-text" class="mt-4 text-sm text-gray-400">æ­£åœ¨è¼‰å…¥æ’­æ”¾å™¨...</p>
    </div>

    <div id="presentation-container">
        <iframe 
            id="slide-frame"
            src="https://docs.google.com/presentation/d/e/2PACX-1vQHaynvG2zdqsV6dNBSrgw9hyPDyZd8NPjYWF4AFs1BqqpCR_aqU-BTdWGuhUKdl-ANKH7ki4eDcM96/pubembed?start=false&loop=false&delayms=3000" 
            allowfullscreen="true" 
            mozallowfullscreen="true" 
            webkitallowfullscreen="true">
        </iframe>
    </div>

    <div id="music-player-container">
        <div id="yt-player"></div>
    </div>

    <script>
        // ==========================================
        //  è¨­å®šå€ï¼šè«‹ä¿®æ”¹é€™è£¡
        // ==========================================
        // 1. YouTube éŸ³æ¨‚ ID (ä¾‹å¦‚ v=jfKfPfyJRdk)
        const YOUTUBE_MUSIC_ID = "5B5R1bVyZS0"; // Lofi Hip Hop
        // 2. éŸ³é‡ (0-100)
        const MUSIC_VOLUME = 50; 

        // ==========================================
        //  YouTube API è¼‰å…¥èˆ‡è¨­å®š
        // ==========================================
        var player;
        var isPlayerReady = false;

        // 1. å‹•æ…‹è¼‰å…¥ YouTube IFrame API
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // 2. ç•¶ API ä¸‹è¼‰å®Œæˆå¾Œï¼Œæœƒè‡ªå‹•å‘¼å«æ­¤å‡½æ•¸
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('yt-player', {
                height: '200',
                width: '200',
                videoId: YOUTUBE_MUSIC_ID,
                playerVars: {
                    'playsinline': 1,
                    'controls': 0,     // ä¸é¡¯ç¤ºæ§åˆ¶åˆ—
                    'loop': 1,         // å¾ªç’°æ’­æ”¾ (éœ€é…åˆ playlist)
                    'playlist': YOUTUBE_MUSIC_ID // å¾ªç’°æ’­æ”¾å¿…é ˆæŒ‡å®š playlist
                },
                events: {
                    'onReady': onPlayerReady
                }
            });
        }

        // 3. æ’­æ”¾å™¨æº–å‚™å¥½å¾Œçš„è™•ç†
        function onPlayerReady(event) {
            isPlayerReady = true;
            player.setVolume(MUSIC_VOLUME);
            document.getElementById('loading-text').innerText = "ç³»çµ±å°±ç·’ï¼Œæº–å‚™å‡ºç™¼ï¼";
            document.getElementById('loading-text').className = "mt-4 text-sm text-green-600 font-bold";
        }

        // ==========================================
        //  å…¨è¢å¹•èˆ‡é€£å‹•é‚è¼¯
        // ==========================================
        
        function startExperience() {
            if (!isPlayerReady) {
                alert("éŸ³æ¨‚è¼‰å…¥ä¸­ï¼Œè«‹ç¨å¾Œ...");
                return;
            }

            const container = document.getElementById('presentation-container');
            
            // A. é¡¯ç¤ºç°¡å ±å®¹å™¨
            container.style.display = 'block';

            // B. è«‹æ±‚å…¨è¢å¹•
            if (container.requestFullscreen) {
                container.requestFullscreen();
            } else if (container.webkitRequestFullscreen) { 
                container.webkitRequestFullscreen();
            } else if (container.msRequestFullscreen) { 
                container.msRequestFullscreen();
            }

            // C. â˜… é—œéµï¼šåŒæ™‚æ’­æ”¾éŸ³æ¨‚
            // ç”±æ–¼é€™æ˜¯ä½¿ç”¨è€…é»æ“Šè§¸ç™¼çš„ (User Interaction)ï¼Œç€è¦½å™¨å…è¨±è‡ªå‹•æ’­æ”¾
            player.playVideo();

            // D. ç¶å®šç›£è½å™¨ (è™•ç† Esc é€€å‡º)
            setupExitListener();
        }

        // ç›£è½å…¨è¢å¹•ç‹€æ…‹æ”¹è®Š
        function setupExitListener() {
            document.addEventListener('fullscreenchange', handleExit);
            document.addEventListener('webkitfullscreenchange', handleExit);
            document.addEventListener('mozfullscreenchange', handleExit);
            document.addEventListener('MSFullscreenChange', handleExit);
        }

        function handleExit() {
            // å¦‚æœç›®å‰æ²’æœ‰å…¨è¢å¹•å…ƒç´  (ä»£è¡¨ä½¿ç”¨è€…æŒ‰äº† Esc æˆ–æ˜¯é€€å‡ºäº†)
            if (!document.fullscreenElement && 
                !document.webkitIsFullScreen && 
                !document.mozFullScreen && 
                !document.msFullscreenElement) {
                
                // 1. æš«åœéŸ³æ¨‚
                if (player && typeof player.pauseVideo === 'function') {
                    player.pauseVideo();
                    // æˆ–è€…ä½¿ç”¨ player.stopVideo(); è‹¥å¸Œæœ›ä¸‹æ¬¡å¾é ­é–‹å§‹
                }

                // 2. éš±è—ç°¡å ±å®¹å™¨
                document.getElementById('presentation-container').style.display = 'none';

                // 3. ç§»é™¤ç›£è½å™¨ (é¿å…é‡è¤‡ç¶å®š)
                document.removeEventListener('fullscreenchange', handleExit);
                document.removeEventListener('webkitfullscreenchange', handleExit);
            }
        }
    </script>
</body>
</html>